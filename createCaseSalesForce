{
  "name": "createCaseSalesForce",
  "version": "0.0.8",
  "type": "actuator",
  "script": "var user = options.globalSettings.salesForceUser\nvar token = options.globalSettings.salesForceToken\nvar caseObject = { }\n\ncaseObject.Subject = waylayUtil.getProperty(options, \"Subject\")\ncaseObject.Description = waylayUtil.getProperty(options, \"Description\")\ncaseObject.Status = waylayUtil.getProperty(options, \"Status\")\ncaseObject.Priority = waylayUtil.getProperty(options, \"Priority\")\ncaseObject.AssetId = waylayUtil.getProperty(options, \"AssetId\") || waylayUtil.getResource(options)\ncaseObject.AccountId = waylayUtil.getProperty(options, \"AccountId\")\ncaseObject.Reason = waylayUtil.getProperty(options, \"Reason\")\ncaseObject.OwnerId = waylayUtil.getProperty(options, \"OwnerId\")\ncaseObject.Product__c = waylayUtil.getProperty(options, \"Product__c\")\n\ncaseObject = _.reduce(caseObject, (acc, v, k) => {\n    if (v) {\n        acc[k] = v   \n    }\n    \n    return acc\n}, {})\n\nif(caseObject.Subject)\n    caseObject.Subject = waylayUtil.template(options, \"Subject\")\nif(caseObject.Description)\n    caseObject.Description = waylayUtil.template(options, \"Description\")\n\nconsole.log(\"caseObject\", caseObject)\nif(user === undefined || token === undefined) {\n    send(new Error(\"missing inputs\"))\n}\nelse {\n    try{\n        var conn = new jsforce.Connection()\n        conn.login(user, token, function(err, res){\n            if (err) { \n              console.error(err)\n              send(new Error(err))\n            } else{\n                 conn.sobject(\"Case\").create(caseObject, function(err, ret) {\n                    if (err) { \n                       console.error(err)\n                       send(new Error(err))\n                    } else {\n                        send(null, {message: JSON.stringify(ret)});\n                    }\n                  })\n            }\n        })\n    }\n    catch(err){\n        console.error(err)\n        send(new Error(err))\n    }\n}\n",
  "metadata": {
    "author": "",
    "category": "SalesForce",
    "description": "Add case in SalesForce, all fields are optional.\nIf accountId is not provided, it will be using the account\nof the person to who belongs the API token.\nIf AssetId it will take waylay resource as AssetId.",
    "iconURL": "https://static.waylay.io/plugs/icons/salesforce-add-feed-item.png",
    "supportedStates": [],
    "requiredProperties": [
      "Subject",
      "Status",
      "Priority",
      "AssetId",
      "AccountId",
      "Reason",
      "OwnerId",
      "Product__c",
      "Description"
    ],
    "requiredRawData": []
  }
}
